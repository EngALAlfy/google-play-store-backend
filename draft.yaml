models:
  User:
    name: string:255
    email: string:255 unique email
    password: string confirmed
    facebook: string:255 nullable
    whatsapp: string:15 regex:/^\+?[0-9]+$/ nullable
    phone: string:15 regex:/^\+?[0-9]+$/ nullable
    website: string:255 url nullable
    timestamps: true
    relationships:
        hasMany: accounts,orders

  Account:
    seller_id: foreign:users exists:users,id
    creation_date: date
    apps_count: integer
    description: text nullable
    price: float
    photo: string:2048 nullable
    website: string:255 url nullable
    timestamps: true
    relationships:
      belongsTo: user
      hasMany: orderItems

  Plan:
    name: string:255
    description: text nullable
    price: float
    accounts_count: integer
    old_accounts: boolean
    photo: string:2048 nullable
    website: string:255 url nullable
    timestamps: true

  Order:
    buyer_id: foreign:users exists:users,id
    seller_id: foreign:users nullable exists:users,id
    account_id: foreign:accounts nullable exists:accounts,id
    broker_id: foreign:users nullable exists:users,id
    total_price: float
    description: text nullable
    photo: string:2048 nullable
    website: string:255 url nullable
    timestamps: true
    relationships:
      belongsTo: user
      hasMany: orderItems

  OrderItem:
    order_id: foreign:orders exists:orders,id
    account_id: foreign:accounts exists:accounts,id
    price: float
    description: text nullable
    photo: string:2048 nullable
    website: string:255 url nullable
    timestamps: true
    relationships:
      belongsTo: order,account

controllers:
  User:
    index:
      query: all
      response: 200 with:users

    store:
      validate: name, email, password, role
      save: user
      fire: NewUserRegistered with:user
      response: 201 with:user

    show:
      find: id
      response: 200 with:user

    update:
      find: id
      validate: name, email, role
      update: user
      response: 200 with:user

    destroy:
      find: id
      delete: user
      response: 204

  Account:
    index:
      query: all
      response: 200 with:accounts

    store:
      validate: seller_id, creation_date, apps_count, description, price
      save: account
      response: 201 with:account

    show:
      find: id
      response: 200 with:account

    update:
      find: id
      validate: creation_date, apps_count, description, price
      update: account
      response: 200 with:account

    destroy:
      find: id
      delete: account
      response: 204

  Plan:
    index:
      query: all
      response: 200 with:plans

    store:
      validate: name, description, price, accounts_count, old_accounts
      save: plan
      response: 201 with:plan

    show:
      find: id
      response: 200 with:plan

    update:
      find: id
      validate: name, description, price, accounts_count, old_accounts
      update: plan
      response: 200 with:plan

    destroy:
      find: id
      delete: plan
      response: 204

  Order:
    index:
      query: all
      response: 200 with:orders

    store:
      validate: buyer_id, seller_id, account_id, broker_id, total_price, description
      save: order
      dispatch: ProcessOrder with:order
      fire: NewOrderPlaced with:order
      response: 201 with:order

    show:
      find: id
      response: 200 with:order

    update:
      find: id
      validate: total_price, description
      update: order
      response: 200 with:order

    destroy:
      find: id
      delete: order
      response: 204

  OrderItem:
    store:
      validate: order_id, account_id, price, description
      save: orderItem
      response: 201 with:orderItem

    destroy:
      find: id
      delete: orderItem
      response: 204
